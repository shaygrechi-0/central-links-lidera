<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Central de Planilhas e Documentos</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #070813;
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --border: rgba(255,255,255,.10);

      --blue: #2f3a8a;
      --gold: #caa24a;

      --radius: 16px;
      --shadow: 0 10px 28px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 10% 0%, rgba(47,58,138,.18), transparent 60%),
        radial-gradient(700px 380px at 90% 10%, rgba(202,162,74,.10), transparent 55%),
        var(--bg);
      min-height:100vh;
    }

    .wrap{max-width:1100px;margin:0 auto;padding:26px 18px 44px}

    .topbar{
      display:flex;gap:14px;align-items:center;justify-content:space-between;
      padding:14px 16px;
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      background:rgba(255,255,255,.04);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }

    .brand{display:flex;gap:12px;align-items:center;min-width:260px}
    .logo{
      width:48px;height:48px;border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.20);
      display:grid;place-items:center;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .brand h1{font-size:16px;margin:0;line-height:1.15}
    .brand p{margin:2px 0 0 0;font-size:12px;color:var(--muted)}

    .right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:10px;
      flex:1;
    }

    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .input, .select{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
      color:var(--text);
      padding:10px 12px;border-radius:12px;
      outline:none;
      min-width:240px;
    }
    .select{min-width:190px}
    .input::placeholder{color:rgba(255,255,255,.55)}
    .btn{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      color:var(--text);
      padding:10px 14px;border-radius:12px;
      cursor:pointer;
      transition:.12s transform ease, .12s filter ease;
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.04)}
    .btn:active{transform:translateY(0px)}

    .shortcuts{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .sbtn{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.20);
      color:rgba(255,255,255,.86);
      padding:7px 10px;
      border-radius:999px;
      cursor:pointer;
      font-size:12px;
      transition:.12s transform ease, .12s filter ease;
    }
    .sbtn:hover{transform:translateY(-1px);filter:brightness(1.05)}
    .sbtn.gold{
      border-color: rgba(202,162,74,.40);
      background: rgba(202,162,74,.14);
      color: rgba(255,255,255,.92);
    }

    .stats{margin:14px 2px 0;display:flex;gap:10px;flex-wrap:wrap}
    .pill{
      font-size:12px;color:var(--muted);
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
    }
    .pill b{color:var(--text);font-weight:600}

    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:12px;
    }

    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(2, minmax(0, 1fr));}
      .brand{min-width:auto}
      .right{align-items:stretch}
      .shortcuts{justify-content:flex-start}
      .controls{justify-content:flex-start}
      .input{min-width:0;flex:1}
    }
    @media (max-width: 640px){
      .topbar{flex-direction:column;align-items:stretch}
      .right{align-items:stretch}
      .controls{justify-content:stretch}
      .input,.select{min-width:0;width:100%}
      .grid{grid-template-columns: 1fr;}
      .shortcuts{justify-content:flex-start}
    }

    .card{
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      background:rgba(255,255,255,.035);
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card-inner{padding:14px}
    .card h3{margin:0;font-size:14px;line-height:1.25}

    .meta{
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center
    }

    .badge{
      font-size:11px;
      padding:3px 8px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      color:rgba(255,255,255,.82);
    }
    .badge.gold{
      border-color: rgba(202,162,74,.40);
      background: rgba(202,162,74,.12);
    }
    .tag{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.20);
      color:rgba(255,255,255,.78);
    }

    .actions{
      margin-top:12px;
      display:flex;gap:10px;flex-wrap:wrap
    }
    .linkbtn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:9px 12px;border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.22);
      color:var(--text);
      text-decoration:none;
      font-size:12px;
      transition:.12s transform ease, .12s filter ease;
    }
    .linkbtn.primary{
      border:1px solid rgba(202,162,74,.40);
      background:rgba(202,162,74,.14);
    }
    .linkbtn:hover{transform:translateY(-1px);filter:brightness(1.05)}
    .linkbtn:active{transform:translateY(0px)}

    footer{
      margin-top:18px;
      color:rgba(255,255,255,.55);
      font-size:12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" title="Logo">
          <!-- Sua logo está na raiz do repo: logo.png -->
          <img src="logo.png" alt="Academia Lidera"
               onerror="this.style.display='none';">
        </div>
        <div>
          <h1 id="pageTitle">Central de Planilhas e Documentos</h1>
          <p id="pageSubtitle">Academia Lidera • Acesso rápido</p>
        </div>
      </div>

      <div class="right">
        <div class="controls">
          <input id="q" class="input" placeholder="Buscar por nome, categoria ou tag..." />
          <select id="cat" class="select">
            <option value="">Todas as categorias</option>
          </select>
          <button class="btn" id="clear">Limpar</button>
        </div>

        <div id="shortcuts" class="shortcuts"></div>
      </div>
    </div>

    <div class="stats">
      <div class="pill">Total: <b id="count">0</b></div>
      <div class="pill">Categoria: <b id="catLabel">Todas</b></div>
      <div class="pill">Busca: <b id="qLabel">—</b></div>
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>

    <footer>
      Dica: garanta que as permissões (view/edit) das planilhas estejam corretas para evitar “acesso negado”.
    </footer>
  </div>

  <script>
    const state = { data: null, q: "", cat: "" };

    function normalize(s){
      return (s ?? "").toString().trim().toLowerCase();
    }

    function matches(item){
      const q = normalize(state.q);
      if(!q) return true;
      const hay = [
        item.name, item.category, item.type, ...(item.tags || []), item.url
      ].map(normalize).join(" ");
      return hay.includes(q);
    }

    function filterData(){
      const links = state.data?.links || [];
      return links
        .filter(l => !state.cat || l.category === state.cat)
        .filter(matches);
    }

    function uniqueCategories(links){
      return [...new Set(links.map(l => l.category).filter(Boolean))].sort((a,b)=>a.localeCompare(b));
    }

    function escapeHtml(str){
      return (str ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderCategories(){
      const select = document.getElementById("cat");
      const cats = uniqueCategories(state.data.links || []);
      select.innerHTML = `<option value="">Todas as categorias</option>` + cats.map(c => (
        `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`
      )).join("");
    }

    function renderShortcuts(){
      const el = document.getElementById("shortcuts");
      if(!el) return;

      const shortcuts = [
        { label: "Presença", q: "presença", cat: "" },
        { label: "Cancelamentos", q: "cancelamento", cat: "" },
        { label: "POP / Operação", q: "pop", cat: "" },
        { label: "Matrículas", q: "", cat: "Matrículas" },
        { label: "Alunos", q: "", cat: "Alunos" },
        { label: "Tudo", q: "", cat: "" }
      ];

      el.innerHTML = shortcuts.map((s, i) => `
        <button class="sbtn ${i===0 ? "gold" : ""}" data-q="${escapeHtml(s.q)}" data-cat="${escapeHtml(s.cat)}">
          ${escapeHtml(s.label)}
        </button>
      `).join("");

      el.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          state.q = btn.dataset.q || "";
          state.cat = btn.dataset.cat || "";
          document.getElementById("q").value = state.q;
          document.getElementById("cat").value = state.cat;
          render();
        });
      });
    }

    function render(){
      const grid = document.getElementById("grid");
      const items = filterData();

      document.getElementById("count").textContent = items.length;
      document.getElementById("catLabel").textContent = state.cat || "Todas";
      document.getElementById("qLabel").textContent = state.q ? `"${state.q}"` : "—";

      if(items.length === 0){
        grid.innerHTML = `
          <div class="card" style="grid-column:1/-1">
            <div class="card-inner">
              <h3>Nenhum link encontrado</h3>
              <div class="meta">Tente outra busca, ou selecione “Todas as categorias”.</div>
            </div>
          </div>
        `;
        return;
      }

      grid.innerHTML = items.map(item => {
        // Menos poluição visual: no máximo 2 tags
        const tags = (item.tags || []).slice(0, 2);

        return `
          <div class="card">
            <div class="card-inner">
              <h3>${escapeHtml(item.name)}</h3>
              <div class="meta">
                ${item.type ? `<span class="badge">${escapeHtml(item.type)}</span>` : ""}
                ${item.category ? `<span class="badge gold">${escapeHtml(item.category)}</span>` : ""}
                ${tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
              </div>
              <div class="actions">
                <a class="linkbtn primary" href="${escapeHtml(item.url)}" target="_blank" rel="noopener">Abrir</a>
                <a class="linkbtn" href="${escapeHtml(item.url)}" target="_blank" rel="noopener">Nova aba</a>
              </div>
            </div>
          </div>
        `;
      }).join("");
    }

    async function init(){
      const res = await fetch("./links.json", { cache: "no-store" });
      if(!res.ok) throw new Error("Não consegui carregar links.json");
      state.data = await res.json();

      document.getElementById("pageTitle").textContent = state.data.title || "Central de Links";
      document.getElementById("pageSubtitle").textContent = state.data.subtitle || "";

      renderCategories();
      renderShortcuts();
      render();

      document.getElementById("q").addEventListener("input", (e) => {
        state.q = e.target.value;
        render();
      });

      document.getElementById("cat").addEventListener("change", (e) => {
        state.cat = e.target.value;
        render();
      });

      document.getElementById("clear").addEventListener("click", () => {
        state.q = "";
        state.cat = "";
        document.getElementById("q").value = "";
        document.getElementById("cat").value = "";
        render();
      });
    }

    init().catch(err => {
      console.error(err);
      document.getElementById("grid").innerHTML = `
        <div class="card" style="grid-column:1/-1">
          <div class="card-inner">
            <h3>Erro ao carregar links</h3>
            <div class="meta">Verifique se <b>links.json</b> está na mesma pasta do <b>index.html</b>.</div>
          </div>
        </div>
      `;
    });
  </script>
</body>
</html>
