<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Central de Planilhas e Documentos</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Light theme (premium, clean) */
      --bg: #F6F7FB;
      --card: rgba(255,255,255,.92);
      --card2: rgba(255,255,255,.70);
      --text: rgba(16,20,34,.92);
      --muted: rgba(16,20,34,.62);
      --border: rgba(16,20,34,.10);

      --blue: #2f3a8a;
      --gold: #caa24a;

      --r12: 12px;
      --r14: 14px;
      --r16: 16px;

      --shadow: 0 10px 24px rgba(16,20,34,.10);
      --shadowSoft: 0 6px 16px rgba(16,20,34,.10);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 12% 0%, rgba(47,58,138,.12), transparent 60%),
        radial-gradient(700px 380px at 92% 10%, rgba(202,162,74,.10), transparent 55%),
        var(--bg);
      min-height:100vh;
    }

    .wrap{max-width:1120px;margin:0 auto;padding:22px 18px 42px}

    /* Header */
    .topbar{
      display:flex;gap:16px;align-items:center;justify-content:space-between;
      padding:12px 14px;
      border:1px solid var(--border);
      border-radius:var(--r16);
      background: rgba(255,255,255,.78);
      box-shadow: var(--shadowSoft);
      backdrop-filter: blur(10px);
    }

    .brand{display:flex;gap:12px;align-items:center;min-width:260px}
    .logo{
      width:44px;height:44px;border-radius:var(--r14);
      border:1px solid var(--border);
      background: rgba(255,255,255,.9);
      display:grid;place-items:center;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .brand h1{font-size:15px;margin:0;line-height:1.2;font-weight:650;letter-spacing:.1px}
    .brand p{margin:2px 0 0 0;font-size:12px;color:var(--muted)}

    .right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
      flex:1;
      min-width:320px;
    }

    /* Search row */
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .input, .select{
      border:1px solid var(--border);
      background: rgba(255,255,255,.88);
      color:var(--text);
      padding:10px 12px;border-radius:var(--r12);
      outline:none;
      min-width:240px;
      height:40px;
    }
    .select{min-width:190px}
    .input::placeholder{color:rgba(16,20,34,.45)}
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.88);
      color:var(--text);
      padding:10px 14px;border-radius:var(--r12);
      cursor:pointer;
      transition:.12s transform ease, .12s filter ease;
      white-space:nowrap;
      height:40px;
      font-weight:500;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.02)}
    .btn:active{transform:translateY(0px)}

    /* Shortcuts */
    .shortcuts{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .sbtn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.78);
      color: rgba(16,20,34,.84);
      padding:7px 10px;
      border-radius:999px;
      cursor:pointer;
      font-size:12px;
      transition:.12s transform ease, .12s filter ease;
    }
    .sbtn:hover{transform:translateY(-1px);filter:brightness(1.02)}
    .sbtn.gold{
      border-color: rgba(202,162,74,.55);
      background: rgba(202,162,74,.18);
      color: rgba(16,20,34,.90);
    }

    /* Stats line */
    .stats{
      margin:14px 2px 0;
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      color:rgba(16,20,34,.62);
      font-size:12px;
      align-items:center;
    }
    .dot{
      width:4px;height:4px;border-radius:50%;
      background:rgba(16,20,34,.22);
      display:inline-block;
      transform: translateY(-1px);
    }
    .stats b{color:rgba(16,20,34,.92);font-weight:600}

    /* Grid/cards */
    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:12px;
    }

    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(2, minmax(0, 1fr));}
      .right{align-items:stretch; min-width:auto}
      .shortcuts{justify-content:flex-start}
      .controls{justify-content:flex-start}
      .input{min-width:0;flex:1}
    }
    @media (max-width: 640px){
      .topbar{flex-direction:column;align-items:stretch}
      .right{align-items:stretch}
      .controls{justify-content:stretch}
      .input,.select{min-width:0;width:100%}
      .grid{grid-template-columns: 1fr;}
      .shortcuts{justify-content:flex-start}
    }

    /* Card is clickable (whole card) */
    .card{
      border:1px solid var(--border);
      border-radius:var(--r16);
      background:var(--card);
      box-shadow: var(--shadowSoft);
      overflow:hidden;
      position:relative;
      text-decoration:none;
      color:inherit;
      display:block;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: rgba(47,58,138,.22);
    }
    .card:active{transform: translateY(-1px);}

    .card-inner{
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:132px;
    }

    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }

    .card h3{
      margin:0;
      font-size:14px;
      line-height:1.25;
      font-weight:600;
      letter-spacing:.1px;
    }

    .openHint{
      font-size:12px;
      color: rgba(47,58,138,.92);
      font-weight:600;
      display:inline-flex;
      gap:6px;
      align-items:center;
      white-space:nowrap;
      opacity:.92;
    }

    .meta{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      color:var(--muted);
      font-size:12px;
      margin-top:-2px;
    }

    .badge{
      font-size:11px;
      padding:3px 8px;border-radius:999px;
      border:1px solid rgba(16,20,34,.12);
      background: rgba(255,255,255,.78);
      color: rgba(16,20,34,.78);
    }
    .badge.gold{
      border-color: rgba(202,162,74,.55);
      background: rgba(202,162,74,.14);
      color: rgba(16,20,34,.84);
    }

    .tag{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(16,20,34,.10);
      background: rgba(255,255,255,.70);
      color: rgba(16,20,34,.70);
    }

    footer{
      margin-top:16px;
      color:rgba(16,20,34,.55);
      font-size:12px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" title="Logo">
          <img src="logo.png" alt="Academia Lidera" onerror="this.style.display='none';">
        </div>
        <div>
          <h1 id="pageTitle">Central de Planilhas e Documentos</h1>
          <p id="pageSubtitle">Academia Lidera • Acesso rápido</p>
        </div>
      </div>

      <div class="right">
        <div class="controls">
          <input id="q" class="input" placeholder="Buscar por nome, categoria ou tag..." />
          <select id="cat" class="select">
            <option value="">Todas as categorias</option>
          </select>
          <button class="btn" id="clear">Limpar</button>
        </div>

        <div id="shortcuts" class="shortcuts"></div>
      </div>
    </div>

    <div class="stats">
      <span>Total: <b id="count">0</b></span>
      <span class="dot"></span>
      <span>Categoria: <b id="catLabel">Todas</b></span>
      <span class="dot"></span>
      <span>Busca: <b id="qLabel">—</b></span>
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>

    <footer>
      Dica: garanta que as permissões (view/edit) das planilhas estejam corretas para evitar “acesso negado”.
    </footer>
  </div>

  <script>
    const state = { data: null, q: "", cat: "" };

    function normalize(s){
      return (s ?? "").toString().trim().toLowerCase();
    }

    function matches(item){
      const q = normalize(state.q);
      if(!q) return true;
      const hay = [
        item.name, item.category, item.type, ...(item.tags || []), item.url
      ].map(normalize).join(" ");
      return hay.includes(q);
    }

    function filterData(){
      const links = state.data?.links || [];
      return links
        .filter(l => !state.cat || l.category === state.cat)
        .filter(matches);
    }

    function uniqueCategories(links){
      return [...new Set(links.map(l => l.category).filter(Boolean))].sort((a,b)=>a.localeCompare(b));
    }

    function escapeHtml(str){
      return (str ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderCategories(){
      const select = document.getElementById("cat");
      const cats = uniqueCategories(state.data.links || []);
      select.innerHTML = `<option value="">Todas as categorias</option>` + cats.map(c => (
        `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`
      )).join("");
    }

    function renderShortcuts(){
      const el = document.getElementById("shortcuts");
      if(!el) return;

      const shortcuts = [
        { label: "Presença", q: "presença", cat: "" },
        { label: "Cancelamentos", q: "cancelamento", cat: "" },
        { label: "POP", q: "pop", cat: "" },
        { label: "Matrículas", q: "", cat: "Matrículas" },
        { label: "Alunos", q: "", cat: "Alunos" },
        { label: "Tudo", q: "", cat: "" }
      ];

      el.innerHTML = shortcuts.map((s, i) => `
        <button class="sbtn ${i===0 ? "gold" : ""}" data-q="${escapeHtml(s.q)}" data-cat="${escapeHtml(s.cat)}">
          ${escapeHtml(s.label)}
        </button>
      `).join("");

      el.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          state.q = btn.dataset.q || "";
          state.cat = btn.dataset.cat || "";
          document.getElementById("q").value = state.q;
          document.getElementById("cat").value = state.cat;
          render();
        });
      });
    }

    function render(){
      const grid = document.getElementById("grid");
      const items = filterData();

      document.getElementById("count").textContent = items.length;
      document.getElementById("catLabel").textContent = state.cat || "Todas";
      document.getElementById("qLabel").textContent = state.q ? `"${state.q}"` : "—";

      if(items.length === 0){
        grid.innerHTML = `
          <div class="card" style="grid-column:1/-1">
            <div class="card-inner">
              <div class="titleRow">
                <h3>Nenhum link encontrado</h3>
                <span class="openHint">Tentar novamente →</span>
              </div>
              <div class="meta">Tente outra busca ou selecione “Todas as categorias”.</div>
            </div>
          </div>
        `;
        return;
      }

      grid.innerHTML = items.map(item => {
        // Ultra clean: no máximo 1 tag (se houver)
        const tag = (item.tags || [])[0];

        return `
          <a class="card" href="${escapeHtml(item.url)}" target="_blank" rel="noopener">
            <div class="card-inner">
              <div>
                <div class="titleRow">
                  <h3>${escapeHtml(item.name)}</h3>
                  <span class="openHint">Abrir →</span>
                </div>
                <div class="meta">
                  ${item.type ? `<span class="badge">${escapeHtml(item.type)}</span>` : ""}
                  ${item.category ? `<span class="badge gold">${escapeHtml(item.category)}</span>` : ""}
                  ${tag ? `<span class="tag">${escapeHtml(tag)}</span>` : ""}
                </div>
              </div>
            </div>
          </a>
        `;
      }).join("");
    }

    async function init(){
      const res = await fetch("./links.json", { cache: "no-store" });
      if(!res.ok) throw new Error("Não consegui carregar links.json");
      state.data = await res.json();

      document.getElementById("pageTitle").textContent = state.data.title || "Central de Links";
      document.getElementById("pageSubtitle").textContent = state.data.subtitle || "";

      renderCategories();
      renderShortcuts();
      render();

      document.getElementById("q").addEventListener("input", (e) => {
        state.q = e.target.value;
        render();
      });

      document.getElementById("cat").addEventListener("change", (e) => {
        state.cat = e.target.value;
        render();
      });

      document.getElementById("clear").addEventListener("click", () => {
        state.q = "";
        state.cat = "";
        document.getElementById("q").value = "";
        document.getElementById("cat").value = "";
        render();
      });
    }

    init().catch(err => {
      console.error(err);
      document.getElementById("grid").innerHTML = `
        <div class="card" style="grid-column:1/-1">
          <div class="card-inner">
            <div class="titleRow">
              <h3>Erro ao carregar links</h3>
              <span class="openHint">Verificar →</span>
            </div>
            <div class="meta">Confira se <b>links.json</b> está na mesma pasta do <b>index.html</b>.</div>
          </div>
        </div>
      `;
    });
  </script>
</body>
</html>
